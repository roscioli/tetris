window.onload=function(){var a=10,b=14,c=Date.now(),d=600,e=0,f=!1,g=!1,h=[],i=function(a,b){this.y=a,this.x=b},j={x:0,y:0,color:"",coordinates:[]},k={square:[new i(0,0),new i(0,1),new i(1,0),new i(1,1)],rightL:[new i(1,0),new i(1,1),new i(1,2),new i(0,2)],rightS:[new i(0,0),new i(0,1),new i(1,1),new i(1,2)],leftL:[new i(0,0),new i(1,0),new i(1,1),new i(1,2)],leftS:[new i(1,0),new i(1,1),new i(0,1),new i(0,2)],line:[new i(0,0),new i(0,1),new i(0,2),new i(0,3)]},l=1,m="*",n=function(){h=[];for(var a=0;b>a;a++)h.push(o())},o=function(b){for(var c=[],d=b?b:0,e=0;a>e;e++)c.push(d);return c},p=function(){document.onkeydown=function(a){if(a=a||window.event,f)return void H(!1);switch(a.keyCode){case 37:B();break;case 38:z();break;case 39:C();break;case 40:D();break;case 32:E();break;default:H(!0)}}},q=function(){return h[0].contains(l)};Array.prototype.last=function(){return this[this.length-1]},Array.prototype.contains=function(a){return this.indexOf(a)>=0};var r=function(a){return!a.contains(0)},s=function(){for(var a=[],b=[],c=h.length-1;c>=0;c--){var d=h[c];r(d)?a.push(o()):b.unshift(d)}h=a.concat(b),J.renderMatrix()},t=function(){j.y=0;var b=Object.keys(k);j.coordinates=k[b[Math.floor(Math.random()*b.length)]];var c=j.coordinates.reduce(function(a,b){return Math.max(a,b.x)},0);j.x=Math.floor((a-c)/2),w()},u=function(a){if("clear"===a){var b=0;J.clearPiece()}else{var b=m;J.drawPiece("#ffffff")}for(var b="clear"===a?0:m,c=0;c<j.coordinates.length;c++){var d=j.coordinates[c];h[j.y+d.y][j.x+d.x]=b}},v=function(){u("clear")},w=function(){u("draw")},x=function(){for(var a=0;a<j.coordinates.length;a++)h[j.coordinates[a].y+j.y][j.coordinates[a].x+j.x]=l},y=function(){for(var a=[],b=0;b<j.coordinates.length;b++){var c=j.coordinates[b];a.push(new i(c.y,c.x))}return a},z=function(){var a=y();a=a.map(function(a){return new i(0-a.x,a.y)});var b=j.coordinates.reduce(function(a,b){return new i(null,Math.max(a.x,b.x))},j.coordinates[0]).x;a=a.map(function(a){return new i(a.y+b,a.x)}),a.every(function(a){return!G(a.y+j.y,a.x+j.x)})&&(v(),j.coordinates=a,w())},A=function(){v(),j.y++,w()},B=function(){F("left")||(v(),j.x--,w())},C=function(){F("right")||(v(),j.x++,w())},D=function(){F("bottom")||(v(),j.y++,w())},E=function(){for(;!F("bottom");)v(),j.y++,w()},F=function(a){if("right"===a)var b=function(a){return new i(a.y,a.x+1)};else"left"===a?b=function(a){return new i(a.y,a.x-1)}:"bottom"===a&&(b=function(a){return new i(a.y+1,a.x)});for(var c=j.coordinates.map(b),d=0;d<c.length;d++){var e=c[d].x+j.x,f=c[d].y+j.y;if(G(f,e))return!0}return!1},G=function(b,c){return 0>c||c>=a||b>=h.length||h[b][c]===l},H=function(a){f=a},I=function(){var c=30,d=document.getElementById("canvas");d.width=c*a,d.height=c*b,window.context=d.getContext("2d");var e="#000000",f="rebeccapurple",g=function(){return f};this.initializeCanvas=function(){window.context.fillStyle=e,window.context.fillRect(0,0,d.width,d.height)},this.drawPiece=function(a){"clear"===a?window.context.fillStyle=e:window.context.fillStyle=g();for(var b=0;b<j.coordinates.length;b++){var d=(j.x+j.coordinates[b].x)*c,f=(j.y+j.coordinates[b].y)*c;window.context.fillRect(d,f,c,c)}},this.clearPiece=function(){this.drawPiece("clear")},this.renderMatrix=function(){for(var d=0;b>d;d++)for(var f=0;a>f;f++){switch(h[d][f]){case l:window.context.fillStyle=g();break;default:window.context.fillStyle=e}window.context.fillRect(f*c,d*c,c,c)}}},J=new I,K=function(){window.setTimeout(function(){if(!f){if(g)return;if(c=Date.now(),F("bottom")&&0!==e){if(x(),s(),q())return void(g=!0);t()}else A();e++}K()},d)};window.game=K;var L=function(){J.initializeCanvas(),n(),p(),t(),K()};L()};