window.onload=function(){var a=10,b=14,c=Date.now(),d=600,e=0,f=!1,g=!1,h=[],i=function(a,b){this.y=a,this.x=b},j={x:0,y:0,color:"",coordinates:[]},k={square:[new i(0,0),new i(0,1),new i(1,0),new i(1,1)],rightL:[new i(1,0),new i(1,1),new i(1,2),new i(0,2)],rightS:[new i(0,0),new i(0,1),new i(1,1),new i(1,2)],leftL:[new i(0,0),new i(1,0),new i(1,1),new i(1,2)],leftS:[new i(1,0),new i(1,1),new i(0,1),new i(0,2)],line:[new i(0,0),new i(0,1),new i(0,2),new i(0,3)]},l=1,m="*",n=function(){h=[];for(var a=0;b>a;a++)h.push(o())},o=function(b){for(var c=[],d=b?b:0,e=0;a>e;e++)c.push(d);return c},p=function(){document.onkeydown=function(a){if(a=a||window.event,console.log(a.keyCode),f)return void I(!1);switch(a.keyCode){case 37:C();break;case 38:A();break;case 39:D();break;case 40:E();break;case 32:F();break;default:I(!0)}}},q=function(){console.log("---------- (step: "+e+")");for(var a=0;a<h.length;a++){for(var b="",c=0;c<h[a].length;c++)b+=h[a][c];console.log(b)}console.log("----------")},r=function(){return h[0].contains(l)};Array.prototype.last=function(){return this[this.length-1]},Array.prototype.contains=function(a){return this.indexOf(a)>=0};var s=function(a){return!a.contains(0)},t=function(){for(var a=[],b=[],c=h.length-1;c>=0;c--){var d=h[c];s(d)?a.push(o()):b.unshift(d)}h=a.concat(b),K.renderMatrix()},u=function(){j.y=0;var b=Object.keys(k);j.coordinates=k[b[Math.floor(Math.random()*b.length)]];var c=j.coordinates.reduce(function(a,b){return Math.max(a,b.x)},0);j.x=Math.floor((a-c)/2),x()},v=function(a){if("clear"===a){var b=0;K.clearPiece()}else{var b=m;K.drawPiece("#ffffff")}for(var b="clear"===a?0:m,c=0;c<j.coordinates.length;c++){var d=j.coordinates[c];h[j.y+d.y][j.x+d.x]=b}},w=function(){v("clear")},x=function(){v("draw")},y=function(){for(var a=0;a<j.coordinates.length;a++)h[j.coordinates[a].y+j.y][j.coordinates[a].x+j.x]=l},z=function(){for(var a=[],b=0;b<j.coordinates.length;b++){var c=j.coordinates[b];a.push(new i(c.y,c.x))}return a},A=function(){console.log("rotating piece");var a=z();a=a.map(function(a){return new i(0-a.x,a.y)});var b=j.coordinates.reduce(function(a,b){return new i(null,Math.max(a.x,b.x))},j.coordinates[0]).x;a=a.map(function(a){return new i(a.y+b,a.x)}),a.every(function(a){return!H(a.y+j.y,a.x+j.x)})?(w(),j.coordinates=a,x(),console.log("rotated piece")):(console.log("couldn't rotate piece"),I(!0))},B=function(){w(),j.y++,x()},C=function(){console.log("moving piece left"),G("left")||(console.log("moved piece left"),w(),j.x--,x()),q()},D=function(){console.log("moving piece right"),G("right")||(console.log("moved piece right"),w(),j.x++,x()),q()},E=function(){console.log("moving piece faster downwards"),G("bottom")||(console.log("moved piece faster downwards"),w(),j.y++,x()),q()},F=function(){for(console.log("dropping piece");!G("bottom");)console.log("dropped piece"),w(),j.y++,x();q()},G=function(a){if("right"===a)var b=function(a){return new i(a.y,a.x+1)};else"left"===a?b=function(a){return new i(a.y,a.x-1)}:"bottom"===a&&(b=function(a){return new i(a.y+1,a.x)});for(var c=j.coordinates.map(b),d=0;d<c.length;d++){var e=c[d].x+j.x,f=c[d].y+j.y;if(H(f,e))return!0}return!1},H=function(b,c){return 0>c||c>=a||b>=h.length||h[b][c]===l},I=function(a){f=a},J=function(){var c=30,d=document.getElementById("canvas");d.width=c*a,d.height=c*b,window.context=d.getContext("2d");var e="#000000",f="rebeccapurple",g=function(){return f};this.initialize=function(){window.context.fillStyle=e,window.context.fillRect(0,0,d.width,d.height)},this.drawPiece=function(a){"clear"===a?(console.log("CLEAR WTF"),window.context.fillStyle=e):(console.log("PIECE COLOR WTF???"),window.context.fillStyle=g()),console.log("window.context.fillStyle: "+window.context.fillStyle);for(var b=0;b<j.coordinates.length;b++){var d=(j.x+j.coordinates[b].x)*c,f=(j.y+j.coordinates[b].y)*c;window.context.fillRect(d,f,c,c)}},this.clearPiece=function(){console.log("clearing piece on canvas"),this.drawPiece("clear")},this.renderMatrix=function(){for(var d=0;b>d;d++)for(var f=0;a>f;f++){switch(h[d][f]){case l:window.context.fillStyle=g();break;default:window.context.fillStyle=e}window.context.fillRect(f*c,d*c,c,c)}}},K=new J;K.initialize();var L=function(){window.setTimeout(function(){if(!f){if(g)return;if(c=Date.now(),G("bottom")&&0!==e){if(console.log("piece at bottom"),y(),t(),r())return console.log(j),console.log("game over"),void(g=!0);console.log("piece has reached an end"),u()}else B();e++,q()}L()},d)};window.game=L;var M=function(){n(),p(),u(),L()};M()};